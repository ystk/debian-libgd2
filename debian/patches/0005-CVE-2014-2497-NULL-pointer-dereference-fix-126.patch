From: Remi Collet <fedora@famillecollet.com>
Date: Mon, 4 Aug 2014 10:31:25 +0200
Subject: CVE-2014-2497, NULL pointer dereference, fix #126

---
 src/gdxpm.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/src/gdxpm.c b/src/gdxpm.c
index bad4be3..e63d311 100644
--- a/src/gdxpm.c
+++ b/src/gdxpm.c
@@ -49,6 +49,16 @@ BGD_DECLARE(gdImagePtr) gdImageCreateFromXpm(char *filename)
 	if(overflow2(sizeof(int), number)) {
 		goto done;
 	}
+	for(i = 0; i < number; i++) {
+		/*
+		   avoid NULL pointer dereference
+		   TODO better fix need to manage monochrome/monovisual
+		   see m_color or g4_color or g_color
+		*/
+		if (!image.colorTable[i].c_color) {
+			goto done;
+		}
+	}
 
 	colors = (int *)gdMalloc(sizeof(int) * number);
 	if(colors == NULL) {
