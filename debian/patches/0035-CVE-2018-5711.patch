Index: libgd2-2.1.0/src/gd_gif_in.c
===================================================================
--- libgd2-2.1.0.orig/src/gd_gif_in.c	2019-01-30 12:06:55.023362238 +0100
+++ libgd2-2.1.0/src/gd_gif_in.c	2019-01-30 12:06:55.011362239 +0100
@@ -271,11 +271,6 @@
 		return 0;
 	}
 
-	if(!im->colorsTotal) {
-		gdImageDestroy(im);
-		return 0;
-	}
-
 	/* Check for open colors at the end, so
 	 * we can reduce colorsTotal and ultimately
 	 * BitsPerPixel */
@@ -287,6 +282,11 @@
 		}
 	}
 
+	if(!im->colorsTotal) {
+		gdImageDestroy(im);
+		return 0;
+	}
+
 	return im;
 }
 
@@ -383,7 +383,7 @@
 GetCode_(gdIOCtx *fd, CODE_STATIC_DATA *scd, int code_size, int flag, int *ZeroDataBlockP)
 {
 	int i, j, ret;
-	unsigned char count;
+	int count;
 
 	if(flag) {
 		scd->curbit = 0;
Index: libgd2-2.1.0/tests/gif/CMakeLists.txt
===================================================================
--- libgd2-2.1.0.orig/tests/gif/CMakeLists.txt	2019-01-30 12:06:55.023362238 +0100
+++ libgd2-2.1.0/tests/gif/CMakeLists.txt	2019-01-30 12:06:55.011362239 +0100
@@ -9,6 +9,7 @@
 	bug00066
 	bug00181
 	bug00227
+	php_bug_75571
 )
 
 FOREACH(test_name ${TESTS_FILES})
Index: libgd2-2.1.0/tests/gif/php_bug_75571.c
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ libgd2-2.1.0/tests/gif/php_bug_75571.c	2019-01-30 12:06:55.015362238 +0100
@@ -0,0 +1,28 @@
+/**
+ * Test that GIF reading does not loop infinitely
+ *
+ * We are reading a crafted GIF image which has been truncated.  This would
+ * trigger an infinite loop formerly, but know bails out early, returning
+ * NULL from gdImageCreateFromGif().
+ *
+ * See also https://bugs.php.net/bug.php?id=75571.
+ */
+
+
+#include "gd.h"
+#include "gdtest.h"
+
+
+int main()
+{
+    gdImagePtr im;
+    FILE *fp;
+
+    fp = gdTestFileOpen2("gif", "php_bug_75571.gif");
+    gdTestAssert(fp != NULL);
+    im = gdImageCreateFromGif(fp);
+    gdTestAssert(im == NULL);
+    fclose(fp);
+
+    return gdNumFailures();
+}
Index: libgd2-2.1.0/tests/Makefile.am
===================================================================
--- libgd2-2.1.0.orig/tests/Makefile.am	2019-01-30 12:06:55.023362238 +0100
+++ libgd2-2.1.0/tests/Makefile.am	2019-01-30 12:06:55.015362238 +0100
@@ -267,6 +268,7 @@
 	gif/bug00066_exp.png \
 	gif/bug00005_2_exp.png \
 	gif/bug00066.gif \
+	gif/php_bug_75571.gif \
 	gdimagefilledellipse/bug00191.png \
 	gdimagefilledellipse/bug00010_exp.png \
 	gdimagescatterex/bug00208_2.png \
