From: GD team <pkg-gd-devel@lists.alioth.debian.org>
Date: Wed, 12 Oct 2016 10:12:16 +0200
Subject: fix-compiled-in-version

---
 configure.ac          | 13 ++++++++-----
 src/{gd.h => gd.h.in} | 10 +++++-----
 2 files changed, 13 insertions(+), 10 deletions(-)
 rename src/{gd.h => gd.h.in} (99%)

diff --git a/configure.ac b/configure.ac
index 2f9f744..f1fe0dc 100644
--- a/configure.ac
+++ b/configure.ac
@@ -6,12 +6,12 @@ AC_PREREQ(2.54)
 # Some m4 magic to have correct version number everywhere
 m4_define([gd_MAJOR],[2])dnl
 m4_define([gd_MINOR],[1])dnl
-m4_define([gd_REVISION],[0])dnl
-dnl m4_define([gd_EXTRA],[rc2])
+m4_define([gd_REVISION],[1])dnl
+m4_define([gd_EXTRA],[dev])dnl
 
-m4_ifdef([gd_EXTRA],
-  [m4_define([gd_PKG_VERSION],[gd_MAJOR.gd_MINOR.gd_REVISION-gd_EXTRA])],
-  [m4_define([gd_PKG_VERSION],[gd_MAJOR.gd_MINOR.gd_REVISION])]
+m4_if(m4_len(gd_EXTRA), 0,dnl
+  [m4_define([gd_PKG_VERSION],[gd_MAJOR.gd_MINOR.gd_REVISION])],dnl
+  [m4_define([gd_PKG_VERSION],[gd_MAJOR.gd_MINOR.gd_REVISION-gd_EXTRA])]dnl
 )dnl
 
 AC_INIT([GD], gd_PKG_VERSION, [https://bitbucket.org/libgd/gd-libgd/issues], [libgd], [http://lib.gd])
@@ -25,10 +25,12 @@ GDLIB_MAJOR=gd_MAJOR
 GDLIB_MINOR=gd_MINOR
 GDLIB_REVISION=gd_REVISION
 GDLIB_EXTRA=gd_EXTRA
+GDLIB_VERSION=gd_PKG_VERSION
 AC_SUBST(GDLIB_MAJOR)
 AC_SUBST(GDLIB_MINOR)
 AC_SUBST(GDLIB_REVISION)
 AC_SUBST(GDLIB_EXTRA)
+AC_SUBST(GDLIB_VERSION)
 
 # Dynamic library version information
 # See http://www.gnu.org/software/libtool/manual/libtool.html#Updating-version-info
@@ -455,6 +457,7 @@ AC_MSG_RESULT([
 
 AC_CONFIG_FILES([Makefile
                 src/Makefile
+		src/gd.h
 		tests/Makefile
 		tests/test_config.h
                 config/Makefile
diff --git a/src/gd.h b/src/gd.h.in
similarity index 99%
rename from src/gd.h
rename to src/gd.h.in
index 7bcbabb..91bb99c 100644
--- a/src/gd.h
+++ b/src/gd.h.in
@@ -5,11 +5,11 @@ extern "C" {
 #ifndef GD_H
 #define GD_H 1
 
-#define GD_MAJOR_VERSION 2
-#define GD_MINOR_VERSION 1
-#define GD_RELEASE_VERSION 0
-#define GD_EXTRA_VERSION "alpha"
-#define GD_VERSION_STRING "2.1.0-alpha"
+#define GD_MAJOR_VERSION @GDLIB_MAJOR@
+#define GD_MINOR_VERSION @GDLIB_MINOR@
+#define GD_RELEASE_VERSION @GDLIB_REVISION@
+#define GD_EXTRA_VERSION "@GDLIB_EXTRA@"
+#define GD_VERSION_STRING "@GDLIB_VERSION@"
 
 /* Do the DLL dance: dllexport when building the DLL,
    dllimport when importing from it, nothing when
